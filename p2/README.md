# 共享单车调度优化模型

## 问题描述

在共享单车系统中，单车在不同时段与区域之间分布不均。为提高运营效率，运营方需在每日夜间或早高峰前对车辆进行再分配。本模型建立了单车调度优化模型，以最小化调度成本并满足主要站点的需求。

## 模型算法

### 算法类型

**线性规划（Linear Programming, LP）**

本问题使用整数线性规划（Integer Linear Programming, ILP）进行求解，属于组合优化问题。

### 数学模型

#### 决策变量

- $x_{ij}$: 从站点 $i$ 调度到站点 $j$ 的单车数量（整数型）

#### 目标函数

最小化总调度成本：

$$\min \sum_{i,j} c_{ij} \cdot x_{ij}$$

其中 $c_{ij}$ 表示从站点 $i$ 到站点 $j$ 的单位调度成本：

$$c_{ij} = d_{ij} \cdot c_{distance} + \frac{c_{fixed}}{Q}$$

- $d_{ij}$: 站点 $i$ 到站点 $j$ 的距离（km）
- $c_{distance}$: 单位距离成本（元/km）
- $c_{fixed}$: 每次调度的固定成本（元）
- $Q$: 车辆容量（辆/车）

#### 约束条件

1. **供给约束**：每个站点的调度量不能超过可用库存
   $$\sum_j x_{ij} \leq I_i - I_{min,i}, \quad \forall i$$

   其中：
   - $I_i$: 站点 $i$ 的初始库存
   - $I_{min,i}$: 站点 $i$ 的最低库存阈值

2. **需求约束**：主要站点的需求必须得到满足
   $$\sum_i x_{ij} \geq D_j \cdot \alpha - I_j, \quad \forall j \in M$$

   其中：
   - $D_j$: 站点 $j$ 的预测净需求
   - $\alpha$: 需求满足率（如95%）
   - $M$: 主要站点集合
   - 只考虑 $D_j > 0$ 的情况（需要补充的站点）

3. **库存下限约束**：调度后每个站点的库存不能低于最低阈值
   $$I_i - \sum_j x_{ij} \geq I_{min,i}, \quad \forall i$$

4. **非负约束**：调度量必须非负
   $$x_{ij} \geq 0, \quad \forall i, j$$

5. **整数约束**：调度量必须为整数
   $$x_{ij} \in \mathbb{Z}^+, \quad \forall i, j$$

### 求解方法

使用 **PuLP**（Python Linear Programming）库进行求解，支持多种求解器：

- 默认使用 PuLP 自带的求解器
- 可选：CBC、GLPK、Gurobi 等商业/开源求解器

### 模型特点

1. **精确求解**：线性规划可以保证找到全局最优解（如果存在）
2. **计算效率**：对于中等规模问题（数百个站点），可在合理时间内求解
3. **灵活性**：易于调整目标函数和约束条件
4. **可扩展性**：可以轻松添加新的约束条件（如时间窗、车辆数量限制等）

## 输入数据

模型需要以下输入文件（来自p1目录的输出）：

1. **dbscan_cluster_stats_new.csv**: 所有站点（聚类）的统计信息
2. **dbscan_top30_clusters.csv**: 30个主要站点信息
3. **top30_count.csv**: 30个主要站点24小时每30分钟的借还统计
4. **station_demand_gap.csv**: 30个主要站点早高峰需求预测
5. **processed_data.csv**: 清洗后的原始数据（用于计算初始库存）

## 输出结果

1. **station_initial_inventory.csv**: 所有站点的初始库存
2. **optimal_scheduling_plan.csv**: 最优调度方案（包含调度路径、数量、成本等）
3. **scheduling_visualization.png**: 调度方案可视化图表
4. **scheduling_optimization_report.md**: 详细的分析报告

## 运行方法

```bash
cd p21
python main.py
```

## 参数配置

所有参数都在 `config.py` 中的 `SCHEDULING_CONFIG` 字典中配置，包括：

- 初始库存计算方法
- 库存约束参数
- 调度成本参数
- 需求满足率
- 优化算法参数

## 模型局限性

1. **假设简化**：假设调度可以瞬间完成，未考虑调度时间
2. **静态模型**：当前为静态优化，未考虑动态变化
3. **成本模型**：成本函数相对简单，实际运营中可能更复杂
4. **规模限制**：对于大规模问题（数千个站点），求解时间可能较长

## 改进方向

1. 考虑时间窗约束，优化调度时间安排
2. 引入车辆数量限制和多车型调度
3. 建立动态调度模型，考虑实时需求变化
4. 考虑不确定性，使用鲁棒优化或随机规划
5. 结合机器学习预测，提高需求预测精度

